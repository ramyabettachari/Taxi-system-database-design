CREATE OR REPLACE PROCEDURE
DISPATCH AS
CURSOR cursor_ride_request IS
SELECT RR.REQUEST_ID FROM RIDE_REQUEST RR where STATUS = 'ACTIVE' FOR UPDATE;
thisRequest cursor_ride_request%ROWTYPE;
BEGIN
OPEN cursor_ride_request;
LOOP
FETCH cursor_ride_request INTO thisRequest;
EXIT WHEN (cursor_ride_request%NOTFOUND);
IF EXISTS (SELECT SSN FROM DRIVER where STATUS = 'Y') AND EXISTS (SELECT VEHICLE_NO FROM TAXI where STATUS = 'Y') THEN
  UPDATE RIDE_REQUEST SET STATUS = 'ACCEPTED'
  WHERE CURRENT OF thisRequest;
  INSERT INTO RIDE VALUES(RR.REQUEST_ID, SSN, VEHICLE_NO, SYSDATE, NULL, NULL);
ELSE
  UPDATE RIDE_REQUEST SET STATUS = 'REJECTED'
  WHERE CURRENT OF thisRequest; 
END IF;  
END LOOP;
CLOSE cursor_ride_request;
END;
.
RUN;

CREATE OR REPLACE PROCEDURE
INCREMENTSALARY AS
CURSOR cursor_EMPLOYEE IS
SELECT E.SSN, FLAG FROM EMPLOYEE E FOR UPDATE;
thisEMPLOYEE cursor_EMPLOYEE%ROWTYPE;
BEGIN
OPEN cursor_EMPLOYEE;
LOOP
FETCH cursor_EMPLOYEE INTO thisEMPLOYEE;
EXIT WHEN (cursor_EMPLOYEE%NOTFOUND);
IF EXISTS (SELECT AVERAGE_RATING FROM DRIVER WHERE SSN = E.SSN) AND AVERAGE_RATING > 4.5 THEN
  UPDATE EMPLOYEE SET SALARY = SALARY * 1.07
  WHERE CURRENT OF thisEMPLOYEE; 
ELSE 
  UPDATE EMPLOYEE SET SALARY = SALARY * 1.05
  WHERE CURRENT OF thisEMPLOYEE; 
END LOOP;
CLOSE cursor_EMPLOYEE;
END;
.
RUN;